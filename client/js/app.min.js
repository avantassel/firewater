var firewaterApp=angular.module("firewater",["lbServices","ui.router","leaflet-directive","duScroll","nvd3","ui.bootstrap","ngGeolocation"]).config(function(e,t,o,r,n){n.defaults.useXDomain=!0,n.defaults.headers.common="Content-Type: application/xml",delete n.defaults.headers.common["X-Requested-With"],o.html5Mode(!0),e.state("home",{url:"/",controller:"homeCtrl",templateUrl:"views/home.html"}).state("state",{url:"/state/:state",controller:"stateCtrl",templateUrl:"views/state.html"}).state("location",{url:"/state/:state/:lat,:lng",controller:"stateCtrl",templateUrl:"views/state.html"}).state("otherwise",{url:"*path",templateUrl:"views/not-found.html"}),r.debugEnabled(!1)});firewaterApp.controller("searchCtrl",function(e,t,o){e.searchByCity=!1,e.getLocation=function(e){return e.length<3?"":o.address(e).then(function(e){return e.map(function(e){return e.description})})},e.Search=function(e){e.type&&"submit"==e.type||e&&13===e.which}}).controller("homeCtrl",function(e,t,o,r,n,a,s){t.geocode={state:"us",formatted_address:"",geometry:{}},t.position=null,t.alerts=null,t.inAlertArea=[],t.forecast=null,t.areaPolygonAlerts=null,t.geoAlerts={},t.markers=[],t.geojson={floods:{},fires:{},winter:{},other:{}},t.nearestAlert={miles:0,type:"",lat:0,lng:0},t.forecastOptions={title:{enable:!0,text:"24 Hr Forecast"},chart:{type:"stackedAreaChart",height:450,margin:{top:20,right:20,bottom:30,left:40},x:function(e){return e[0]},y:function(e){return e[1]},useVoronoi:!1,clipEdge:!0,duration:100,useInteractiveGuideline:!0,xAxis:{showMaxMin:!1,tickFormat:function(e){return d3.time.format("%X")(new Date(e))}},yAxis:{tickFormat:function(e){return d3.format(",.2f")(e)}},zoom:{enabled:!0,scaleExtent:[1,10],useFixedDomain:!1,useNiceScale:!1,horizontalOff:!1,verticalOff:!0,unzoomEventType:"dblclick.zoom"}}},angular.extend(t,s.mapOptions(t)),s.getLocation().then(function(e){t.position=e,t.markers.push({icon:s.mapIcons(),lat:e.coords.latitude,lng:e.coords.longitude,message:"Your Location"}),s.geocode(e.coords).then(function(e){return t.geocode=e}).then(function(){var o=[],r=[],n=[];s.forecast(e.coords).then(function(e){for(var a in e.forecasts){var s=new Date(e.forecasts[a].fcst_valid_local);o.push([s.getTime(),e.forecasts[a].dewpt]),r.push([s.getTime(),e.forecasts[a].mslp]),n.push([s.getTime(),e.forecasts[a].wspd])}return t.forecastData=[{key:"Dew Point",values:o},{key:"Mean Sea Level Pressure",values:r},{key:"Wind Speed",values:n}],t.forecast=e})}).then(function(){return t.getAlerts()})},function(e){t.getAlerts()}),t.centerJSON=function(e){a.getMap().then(function(o){var r=[];for(var n in t.geojson[e].data.features[0].geometry.coordinates){var a=t.geojson[e].data.features[0].geometry.coordinates[n];for(var s in a){var l=a[s];for(var i in l)r.push(L.GeoJSON.coordsToLatLng(l[i]))}}return o.fitBounds(r)})},t.getAlerts=function(){s.alerts("us").then(function(e){t.alerts=e,s.mapAlerts(e,t),t.nearestAlert.lat&&t.nearestAlert.lng&&a.getMap().then(function(e){var o=L.geodesicPolyline([L.latLng(t.position.coords.latitude,t.position.coords.longitude),L.latLng(t.nearestAlert.lat,t.nearestAlert.lng)],{color:"#428bca"});o.addTo(e)})})}}).controller("stateCtrl",function(e,t,o,r,n,a,s,l){t.state=o.state,t.alerts=null,t.inAlertArea=[],t.areaPolygonAlerts=null,t.geoAlerts={},t.geojson={floods:{},fires:{},winter:{},other:{}},t.nearestAlert={miles:0,type:"",lat:0,lng:0},angular.extend(t,l.mapOptions(t)),t.centerJSON=function(e){s.getMap().then(function(o){var r=[];for(var n in t.geojson[e].data.features[0].geometry.coordinates){var a=t.geojson[e].data.features[0].geometry.coordinates[n];for(var s in a){var l=a[s];for(var i in l)r.push(L.GeoJSON.coordsToLatLng(l[i]))}}return o.fitBounds(r)})},t.getAlerts=function(){l.alerts(t.state).then(function(e){t.alerts=e,l.mapAlerts(e,t),t.nearestAlert.lat&&t.nearestAlert.lng&&s.getMap().then(function(e){var o=L.geodesicPolyline([L.latLng(t.position.coords.latitude,t.position.coords.longitude),L.latLng(t.nearestAlert.lat,t.nearestAlert.lng)],{color:"#428bca"});o.addTo(e)})})},t.getAlerts()});